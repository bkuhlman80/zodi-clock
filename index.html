<!DOCTYPE html>
<html lang="en">

  <script defer src="https://cdn.jsdelivr.net/npm/astronomy-engine/astronomy.browser.min.js"></script>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Helio‑Geo Zodiac Clock</title>

  <!-- Open Graph -->
  <meta property="og:title" content="Helio‑Geo Zodiac Clock" />
  <meta property="og:description" content="Animated tropical zodiac clock. Year = 123.7 s, Moon synodic = 10 s. Animated/Frozen modes." />
  <meta property="og:image" content="https://bkuhlman80.github.io/helio-geo-zodiac/preview.png?v=2" />
  <meta property="og:url" content="https://bkuhlman80.github.io/helio-geo-zodiac/" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />

  <style>
    :root { --bg:#0b0c10; --panel:#111318; --text:#e6e7eb; --muted:#9aa0aa; --accent:#f5b301; --moon:#9aa3af; --ring:#2a2f39; --grid:#20242c; --earth:#3b82f6; }
    body { margin:0; background:var(--bg); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
    .wrap { max-width: 1080px; margin: 0 auto; padding: 24px; }
    h1 { font-size: 24px; margin: 0 0 12px; }
    .panel { background: var(--panel); border:1px solid #1c1f26; border-radius:16px; padding:12px; }
    .notice { color: var(--muted); font-size: 12px; margin-top: 8px; }
    a { color:#8ab4ff; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Helio‑Geo Zodiac Clock</h1>
    <div class="panel">
      <helio-geo-zodiac-clock style="display:block; width:100%; max-width:960px;"></helio-geo-zodiac-clock>
      <p class="notice">This is a clock, not a cosmology. Geocentric display, heliocentric physics. 0° Aries at the top.</p>
    </div>
  </div>

  <script>
  (function(){
    const SIGNS = ["Aries","Taurus","Gemini","Cancer","Leo","Virgo","Libra","Scorpio","Sagittarius","Capricorn","Aquarius","Pisces"];
    const MS=1000, DAY=86400*MS, YEAR_DAYS=365.24219, MOON_SIDEREAL_DAYS=27.321661, MOON_SYNODIC_DAYS=29.530588853;
    const NEW_MOON_REF = new Date(Date.UTC(2000,0,6,18,14,0));  // real new moon
    const MOON_LONG_REF = new Date(Date.UTC(2000,0,1,12,0,0)); // unused now (kept for reference)
    function marchEquinoxApprox(y){ return new Date(Date.UTC(y,2,20,21,0,0)); }
    function mod(n,m){ return ((n%m)+m)%m; }
    function toDegMin(x){ const d=Math.floor(x); const m=Math.floor((x-d)*60); return `${d}°${String(m).padStart(2,'0')}’`; }
    function signIndex(lon){ return Math.floor(mod(lon,360)/30); }
    function sunLongitudeDeg(d){ const y=d.getUTCFullYear(); let eq=marchEquinoxApprox(y); if(d<eq) eq=marchEquinoxApprox(y-1); const dtDays=(d-eq)/DAY; return mod((dtDays/YEAR_DAYS)*360,360); }
    // Phase-based Moon longitude tied to Sun => phases align by date
    function moonPhaseFrac(d){ const dtDays=(d-NEW_MOON_REF)/DAY; return mod(dtDays,MOON_SYNODIC_DAYS)/MOON_SYNODIC_DAYS; } // 0..1
    function moonLongitudeDegPhase(d, sunLon){ return mod(sunLon + moonPhaseFrac(d)*360, 360); }

function preciseLongitudes(date) {
  if (typeof Astronomy === 'undefined') return null;
  // Sun: apparent true ecliptic-of-date (tropical) longitude, as seen from Earth
  const sunLon = Astronomy.SunPosition(date).elon;                 // degrees 0..360
  // Moon: geocentric ecliptic-of-date longitude
  const moonLon = Astronomy.EclipticGeoMoon(date).elon;            // degrees 0..360
  return { sunLon, moonLon };
}
    function toSceneAngle(deg){ return (-(deg) + 90) * Math.PI/180; } // 0° Aries at top, clockwise
    function ringHit(cx,cy,R, sx,sy, angle){ const dx=Math.cos(angle), dy=Math.sin(angle); const ox=sx-cx, oy=sy-cy; const a=dx*dx+dy*dy, b=2*(ox*dx+oy*dy), c=ox*ox+oy*oy - R*R; const disc=b*b-4*a*c; const t=disc>=0?(-b+Math.sqrt(disc))/(2*a):0; return {x:sx+t*dx,y:sy+t*dy}; }
    function phaseName(age){ const p=age/MOON_SYNODIC_DAYS; if(p<0.03) return "New"; if(p<0.22) return "Waxing Crescent"; if(p<0.28) return "First Quarter"; if(p<0.47) return "Waxing Gibbous"; if(p<0.53) return "Full"; if(p<0.72) return "Waning Gibbous"; if(p<0.78) return "Last Quarter"; if(p<0.97) return "Balsamic"; return "New"; }
    function moonPhaseAgeDays(d){ const dtDays=(d-NEW_MOON_REF)/DAY; return mod(dtDays,MOON_SYNODIC_DAYS); }

    class HelioGeoZodiacClock extends HTMLElement{
      constructor(){ super(); this.attachShadow({mode:'open'}); }
      connectedCallback(){ this.render(); }
      disconnectedCallback(){ cancelAnimationFrame(this._raf); }

      render(){
        const root = document.createElement('div');
        root.innerHTML = `
          <style>
            .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-bottom:10px}
            .group{display:flex;align-items:center;gap:8px;background:#111318;border:1px solid #1c1f26;padding:8px 10px;border-radius:12px}
            .btn{padding:6px 10px;border-radius:999px;border:1px solid #2b2f38;background:#151923;color:#e6e7eb;cursor:pointer}
            .btn.active{background:#e6e7eb;color:#0b0c10}
            .select,.input{background:#151923;color:#e6e7eb;border:1px solid #2b2f38;border-radius:10px;padding:6px 8px}
            .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;margin-bottom:10px}
            .card{background:#111318;border:1px solid #1c1f26;border-radius:16px;padding:10px}
            .small{color:#9aa0aa;font-size:12px}
            .big{font-weight:600}
            .canvas{background:#0f1218;border:1px solid #1d212a;border-radius:16px;padding:10px}
            svg{width:100%;height:auto;display:block}
            .legend{margin-top:6px;color:#9aa0aa;font-size:12px}
            a{color:#8ab4ff}
          </style>
          <div class="controls">
            <div class="group">
              <span class="small">Mode</span>
              <button id="btnAnimated" class="btn active">Animated</button>
              <button id="btnFrozen" class="btn">Frozen</button>
            </div>
            <div class="group" id="dateGroup" style="display:none">
              <span class="small">Date/Time (UTC)</span>
              <input id="dt" class="input" type="datetime-local" />
            </div>
          </div>
          <div class="cards">
            <div class="card">
              <div class="small">Sun line</div>
              <div class="big" id="sunLabel">—</div>
              <div class="small">Ray from Earth through the Sun to the tropical ring.</div>
            </div>
            <div class="card">
              <div class="small">Moon line</div>
              <div class="big" id="moonLabel">—</div>
              <div class="small">Phase: <span id="phaseLabel">—</span></div>
            </div>
            <div class="card">
              <div class="small">Now (UTC)</div>
              <div class="big" id="nowLabel">—</div>
              <div class="small">Illustrative clock. Not ephemeris‑grade.</div>
            </div>
          </div>
          <div class="canvas">
            <svg id="scene" viewBox="0 0 800 800" aria-label="Helio-Geo Zodiac Diagram"></svg>
            <div class="legend">This is a clock, not a cosmology. Geocentric display, heliocentric physics. 0° Aries at top. | <a href="#" id="resetNow">reset to now</a></div>
          </div>
        `;
        this.shadowRoot.innerHTML = '';
        this.shadowRoot.appendChild(root);
        this.afterRender();
      }

      afterRender(){
        const svg = this.shadowRoot.getElementById('scene');
        const W=800,H=800,cx=W/2,cy=H/2; const R_zodiac=350,R_earth=170,R_moon=50;
        const sunLabel=this.shadowRoot.getElementById('sunLabel');
        const moonLabel=this.shadowRoot.getElementById('moonLabel');
        const phaseLabel=this.shadowRoot.getElementById('phaseLabel');
        const nowLabel=this.shadowRoot.getElementById('nowLabel');
        const btnAnimated=this.shadowRoot.getElementById('btnAnimated');
        const btnFrozen=this.shadowRoot.getElementById('btnFrozen');
        const dateGroup=this.shadowRoot.getElementById('dateGroup');
        const dtInput=this.shadowRoot.getElementById('dt');
        const resetNow=this.shadowRoot.getElementById('resetNow');

        const ns = "http://www.w3.org/2000/svg";
        function line(x1,y1,x2,y2,opts={}){ const el=document.createElementNS(ns,'line'); el.setAttribute('x1',x1); el.setAttribute('y1',y1); el.setAttribute('x2',x2); el.setAttribute('y2',y2); if(opts.stroke) el.setAttribute('stroke',opts.stroke); if(opts.width) el.setAttribute('stroke-width',opts.width); if(opts.dash) el.setAttribute('stroke-dasharray',opts.dash); svg.appendChild(el); return el; }
        function circle(x,y,r,opts={}){ const el=document.createElementNS(ns,'circle'); el.setAttribute('cx',x); el.setAttribute('cy',y); el.setAttribute('r',r); if(opts.fill) el.setAttribute('fill',opts.fill); if(opts.stroke) el.setAttribute('stroke',opts.stroke); if(opts.width) el.setAttribute('stroke-width',opts.width); svg.appendChild(el); return el; }
        function text(x,y,str,opts={}){ const el=document.createElementNS(ns,'text'); el.setAttribute('x',x); el.setAttribute('y',y); el.setAttribute('fill',opts.fill||'#e6e7eb'); el.setAttribute('font-size',opts.size||12); el.setAttribute('text-anchor',opts.anchor||'middle'); el.setAttribute('dominant-baseline','middle'); el.textContent=str; svg.appendChild(el); return el; }

        // static ring + labels
        circle(cx,cy,R_zodiac,{fill:'none',stroke:'#2a2f39',width:2});
        for(let i=0;i<12;i++){ const ang=(-i*30+90)*Math.PI/180; const x1=cx+R_zodiac*Math.cos(ang), y1=cy+R_zodiac*Math.sin(ang); line(cx,cy,x1,y1,{stroke:'#20242c',width:1}); const lx=cx+(R_zodiac+22)*Math.cos(ang-15*Math.PI/180); const ly=cy+(R_zodiac+22)*Math.sin(ang-15*Math.PI/180); text(lx,ly,SIGNS[i],{size:13,fill:'#9aa0aa'}); }
        // Sun
        circle(cx,cy,18,{fill:'#f5b301',stroke:'#0b0c10',width:2}); text(cx,cy-30,'Sun',{size:12,fill:'#9aa0aa'});
        // Earth orbit
        circle(cx,cy,R_earth,{fill:'none',stroke:'#1f2937',width:1.5});
        // dynamic bodies
        const earthEl=circle(cx+R_earth,cy,11,{fill:'#3b82f6',stroke:'#0b0c10',width:1.5}); const earthLbl=text(cx+R_earth,cy-18,'Earth',{size:11,fill:'#9aa0aa'});
        const moonOrbitEl=circle(cx+R_earth,cy,R_moon,{fill:'none',stroke:'#2a2f39',width:1});
        const moonEl=circle(cx+R_earth+R_moon,cy,6,{fill:'#9aa3af',stroke:'#0b0c10',width:1}); const moonLbl=text(cx+R_earth+R_moon,cy-12,'Moon',{size:10,fill:'#9aa0aa'});
        // Rays + hits
        const sunRay=line(cx+R_earth,cy,cx+R_earth,cy,{stroke:'#f5b301',width:2.5}); const moonRay=line(cx+R_earth,cy,cx+R_earth,cy,{stroke:'#9aa3af',width:2,dash:'4 3'});
        const sunHit=circle(cx,cy,5,{fill:'#f5b301'}); const moonHit=circle(cx,cy,5,{fill:'#9aa3af'});

        let mode='animated'; let virtualNowMs=Date.now();
        (function(){ const now=new Date(); const iso=new Date(now.getTime()-now.getTimezoneOffset()*60000).toISOString().slice(0,16); dtInput.value=iso; })();

        btnAnimated.onclick=()=>{mode='animated'; btnAnimated.classList.add('active'); btnFrozen.classList.remove('active'); dateGroup.style.display='none';};
        btnFrozen.onclick=()=>{mode='frozen'; btnFrozen.classList.add('active'); btnAnimated.classList.remove('active'); dateGroup.style.display='flex';};
        resetNow.onclick=(e)=>{ e.preventDefault(); virtualNowMs=Date.now(); };

        const updateScene=(d)=>{
          let sunLon, moonLon;
            if (mode === 'frozen') {
              const p = preciseLongitudes(d);
              if (p) { sunLon = p.sunLon; moonLon = p.moonLon; }
              else   { sunLon = sunLongitudeDeg(d); moonLon = moonLongitudeDegPhase(d, sunLon); } // fallback
            } else {
              sunLon = sunLongitudeDeg(d);
              moonLon = moonLongitudeDegPhase(d, sunLon);
            }
          const sunSign=SIGNS[signIndex(sunLon)]; const moonSign=SIGNS[signIndex(moonLon)];
          const mAge=moonPhaseAgeDays(d); const mPhase=phaseName(mAge);
          const thetaEarth=toSceneAngle(mod(sunLon+180,360)); const ex=cx+R_earth*Math.cos(thetaEarth), ey=cy+R_earth*Math.sin(thetaEarth);
          earthEl.setAttribute('cx',ex); earthEl.setAttribute('cy',ey); earthLbl.setAttribute('x',ex); earthLbl.setAttribute('y',ey-18);
          const thetaMoon=toSceneAngle(moonLon); const mx=ex+R_moon*Math.cos(thetaMoon), my=ey+R_moon*Math.sin(thetaMoon);
          moonEl.setAttribute('cx',mx); moonEl.setAttribute('cy',my); moonLbl.setAttribute('x',mx); moonLbl.setAttribute('y',my-12);
          moonOrbitEl.setAttribute('cx',ex); moonOrbitEl.setAttribute('cy',ey);
          const sunAng=Math.atan2(cy-ey, cx-ex); const moonAng=Math.atan2(my-ey, mx-ex);
          const sh=ringHit(cx,cy,350, ex,ey, sunAng); const mh=ringHit(cx,cy,350, ex,ey, moonAng);
          sunRay.setAttribute('x1',ex); sunRay.setAttribute('y1',ey); sunRay.setAttribute('x2',sh.x); sunRay.setAttribute('y2',sh.y);
          moonRay.setAttribute('x1',ex); moonRay.setAttribute('y1',ey); moonRay.setAttribute('x2',mh.x); moonRay.setAttribute('y2',mh.y);
          sunHit.setAttribute('cx',sh.x); sunHit.setAttribute('cy',sh.y); moonHit.setAttribute('cx',mh.x); moonHit.setAttribute('cy',mh.y);
          sunLabel.textContent=`${sunSign} ${toDegMin(mod(sunLon,30))}`;
          moonLabel.textContent=`${moonSign} ${toDegMin(mod(moonLon,30))}`;
          phaseLabel.textContent=mPhase; nowLabel.textContent=d.toISOString().replace('T',' ').slice(0,19);
        };

        const loop=(t)=>{
          if(mode==='animated'){
            const yearMs = 123.7*1000; // visual tropical year duration
            const scale = (YEAR_DAYS*DAY)/yearMs; // single scale -> Moon = ~10 s by real ratio
            // advance virtual clock proportional to real time; assume ~60fps if t not used
            virtualNowMs += 16.67 * scale;
            updateScene(new Date(virtualNowMs));
          } else {
            updateScene(new Date(dtInput.value || Date.now()));
          }
          requestAnimationFrame(loop);
        };
        updateScene(new Date()); requestAnimationFrame(loop);
      }
    }
    customElements.define('helio-geo-zodiac-clock', HelioGeoZodiacClock);
  })();
  </script>
</body>
</html>
